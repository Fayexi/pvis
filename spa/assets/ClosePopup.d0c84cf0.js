import{c as C,h as F,b as _}from"./render.04c64b32.js";import{r as I,q as k,R as A,S as K,a as R,h as B,g as D,M as P,n as L,O as V,I as M}from"./index.abf366c9.js";import{a as O}from"./focus-manager.8e1b27e8.js";import{v as Q}from"./use-router-link.43533fdf.js";import{x as j,y as N}from"./format.921e47b3.js";var H=C({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:n,emit:r}){const d=D(),s=I(null);let f=0;const c=[];function m(t){const u=typeof t=="boolean"?t:e.noErrorFocus!==!0,p=++f,x=(o,a)=>{r("validation"+(o===!0?"Success":"Error"),a)},g=o=>{const a=o.validate();return typeof a.then=="function"?a.then(i=>({valid:i,comp:o}),i=>({valid:!1,comp:o,err:i})):Promise.resolve({valid:a,comp:o})};return(e.greedy===!0?Promise.all(c.map(g)).then(o=>o.filter(a=>a.valid!==!0)):c.reduce((o,a)=>o.then(()=>g(a).then(i=>{if(i.valid===!1)return Promise.reject(i)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return p===f&&x(!0),!0;if(p===f){const{comp:a,err:i}=o[0];if(i!==void 0&&console.error(i),x(!1,a),u===!0){const S=o.find(({comp:E})=>typeof E.focus=="function"&&Q(E.$)===!1);S!==void 0&&S.comp.focus()}}return!1})}function v(){f++,c.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function h(t){t!==void 0&&P(t);const u=f+1;m().then(p=>{u===f&&p===!0&&(e.onSubmit!==void 0?r("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function y(t){t!==void 0&&P(t),r("reset"),L(()=>{v(),e.autofocus===!0&&e.noResetFocus!==!0&&l()})}function l(){O(()=>{if(s.value===null)return;const t=s.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||s.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||s.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(s.value.querySelectorAll("[tabindex]"),u=>u.tabIndex>-1);t!=null&&t.focus({preventScroll:!0})})}k(V,{bindComponent(t){c.push(t)},unbindComponent(t){const u=c.indexOf(t);u>-1&&c.splice(u,1)}});let b=!1;return A(()=>{b=!0}),K(()=>{b===!0&&e.autofocus===!0&&l()}),R(()=>{e.autofocus===!0&&l()}),Object.assign(d.proxy,{validate:m,resetValidation:v,submit:h,reset:y,focus:l,getValidationComponents:()=>c}),()=>B("form",{class:"q-form",ref:s,onSubmit:h,onReset:y},F(n.default))}});function q(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const n=parseInt(e,10);return isNaN(n)?0:n}var J=_({name:"close-popup",beforeMount(e,{value:n}){const r={depth:q(n),handler(d){r.depth!==0&&setTimeout(()=>{const s=j(e);s!==void 0&&N(s,d,r.depth)})},handlerKey(d){M(d,13)===!0&&r.handler(d)}};e.__qclosepopup=r,e.addEventListener("click",r.handler),e.addEventListener("keyup",r.handlerKey)},updated(e,{value:n,oldValue:r}){n!==r&&(e.__qclosepopup.depth=q(n))},beforeUnmount(e){const n=e.__qclosepopup;e.removeEventListener("click",n.handler),e.removeEventListener("keyup",n.handlerKey),delete e.__qclosepopup}});export{J as C,H as Q};
